WITH BGC300 as (
    select distinct PROD_ID as PROD_ID_BGC300, ACNT_PROD_ID from DBGD.DTBGC300 where coalesce(acnt_prod_id,'') != ''
)
,TA AS (
    SELECT '1' AS SRC_TYPE, PROD_ID, PROD_CAT FROM DBGD.DTAGA001_PROD_DEFI
    UNION ALL
    SELECT '2' AS SRC_TYPE, PROD_ID, PROD_CAT
    FROM DBGD.DTAGD101
    UNION ALL SELECT '3' AS SRC_TYPE, ACNT_PROD_ID AS PROD_ID, PROD_CAT
          FROM (
      select BGK001_TMP.PROD_ID, BGK001_TMP.PROD_CAT,  (
          case when BGC300.ACNT_PROD_ID is not null
          and BGC300.ACNT_PROD_ID <> ''
               then BGC300.ACNT_PROD_ID
               else BGK001_TMP.ACNT_PROD_ID end) ACNT_PROD_ID
      from DBGD.DTBGK001 BGK001_TMP
      left join BGC300 on BGC300.PROD_ID_BGC300 = BGK001_TMP.PROD_ID )
),
TB AS (
    SELECT SRC_TYPE, PROD_ID, PROD_CAT
    , ROW_NUMBER() OVER(PARTITION BY PROD_ID ORDER BY SRC_TYPE) NUM FROM TA
)
SELECT * FROM TB WHERE NUM = 1 