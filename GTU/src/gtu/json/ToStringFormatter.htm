<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<style>
	/* Popup box BEGIN */
	.hover_bkgr_fricc{
		background:rgba(0,0,0,.4);
		cursor:pointer;
		display:none;/*none*/
		height:100%; 
		position:fixed;
		text-align:center;
		top:0;
		width:100%;
		z-index:10000;
	}
	.hover_bkgr_fricc .helper{
		display:inline-block;
		height:100%;
		vertical-align:middle;
	}
	.hover_bkgr_fricc > div {
		background-color: #fff;
		box-shadow: 10px 10px 60px #555;
		display: inline-block;
		height: auto;
		max-width: 551px;
		min-height: 100px;
		vertical-align: middle;
		width: 60%;
		position: relative;
		border-radius: 8px;
		padding: 15px 5%;
	}
	.popupCloseButton {
		background-color: #fff;
		border: 3px solid #999;
		border-radius: 50px;
		cursor: pointer;
		display: inline-block;
		font-family: arial;
		font-weight: bold;
		position: absolute;
		top: -20px;
		right: -20px;
		font-size: 25px;
		line-height: 30px;
		width: 30px;
		height: 30px;
		text-align: center;
	}
	.popupCloseButton:hover {
		background-color: #ccc;
	}
	.trigger_popup_fricc {
		cursor: pointer;
		font-size: 20px;
		margin: 20px;
		display: inline-block;
		font-weight: bold;
	}
	/* Popup box BEGIN */

	#box {
		width: 10em;
		height: 10em;
		overflow:auto;
	}
	#box ul {
		line-height: 2em;
	}
	#box ul li a {
		position: relative;
	}
	#box ul li a span {
		display:none;
	}
	#box ul li a:hover span {
		display:block;
		height:200px;
		width:200px;
		position:fixed;
		top:11px0;
		left:100px;
		z-index:2;
		background:#ccc;
	}
	/*-----------------------------------------------------*/
	table { 
		border:1px solid #000; 
		font-family: 微軟正黑體; 
		font-size:16px; 
		width:200px;
		border:1px solid #000;
		text-align:center;
		border-collapse:collapse;
	} 
	th { 
		background-color: #009FCC;
		padding:10px;
		border:1px solid #000;
		color:#fff;
	} 
	td { 
		border:1px solid #000;
		padding:5px;
	} 
</style>

<script type="text/javascript">
	function jsonFormatter(){
		var text = document.querySelector("#testArea").value;
		var lines = text.split('\n');
		var arry = new Array();
		for(var i = 0;i < lines.length;i++){
			var line = lines[i];
			var json = toJson(line);
			if(json){
				arry.push(json);
			}
		}

		var tbody = getTbody();		

		var keys;
		for(var idx in arry){
			var obj = arry[idx];
			if(!keys){
				var tr = createTr();
				tr.appendChild(createTh("選擇"));
				keys = [];
				for(var k in obj){
					keys.push(k);
					var td = createTh(k);
					tr.appendChild(td);
				}
				if(keys.length == 0){
					keys = null;
					continue;
				}
				tbody.appendChild(tr);
			}

			var tr = createTr();
			tr.appendChild(createChoice(obj, idx));
			for(var idx2 in keys){
				var value = obj[keys[idx2]];
				var td = createTd(value);
				tr.appendChild(td);
			}
			tbody.appendChild(tr);
		}
	}

	function getTbody(){
		var tbody1 = document.querySelector("#tbody001");
		var tbody2 = document.createElement("tbody");
		tbody2.setAttribute("id", "tbody001");
		tbody1.parentNode.replaceChild(tbody2, tbody1);
		return tbody2;
	}

	function createChoice(json, idx){
		var td = document.createElement("td");
		var radio = document.createElement("input");
		var textArea = document.createElement("textarea");
		radio.setAttribute("type", "radio");
		radio.setAttribute("name", "testRadio");
		radio.setAttribute("onclick", "javascript:showRecord("+idx+");");
		textArea.setAttribute("style", "display:none;");
		textArea.setAttribute("id", "area_" + idx);
		var text = document.createTextNode(JSON.stringify(json));
		textArea.appendChild(text);
		td.appendChild(textArea);
		td.appendChild(radio);
		return td;
	}

	function showRecord(idx){
		var text = document.querySelector("#area_" + idx).innerText;
		console.log("record = " + text);
		var json = JSON.parse(text);

		var tbody1 = document.querySelector("#tbody002");
		var tbody2 = document.createElement("tbody");
		tbody2.setAttribute("id", "tbody002");
		tbody1.parentNode.replaceChild(tbody2, tbody1);

		var tr1 = document.createElement("tr");
		tr1.appendChild(createTh("欄位"));
		tr1.appendChild(createTh("值"));
		tbody2.appendChild(tr1);

		for(var k in json) {
			var tr = document.createElement("tr");
			tr.appendChild(createTd(k));
			tr.appendChild(createTd(json[k]));
			tbody2.appendChild(tr);
		}
	}

	function createTr(){
		return document.createElement("tr");
	}

	function createTh(data){
		var td = document.createElement("th");
		var text = document.createTextNode(data);
		td.appendChild(text);
		return td;
	}

	function createTd(data){
		var td = document.createElement("td");
		var text = document.createTextNode(data);
		td.appendChild(text);
		return td;
	}

	function toJson(line){
		var json = {};
		var reg = /(\w+)\s*\=\s*(.*?)[\,\]]/gi;
		var found;
		while (found = reg.exec(line)) {
			var key = found[1];
			var value = found[2];
			console.log("----" + key + " = " + value);
			json[key] = value;
		}
		console.log(json)
		return json;
	}

	//-----------------------------------------------------------------------
	function initLoading() {
		console.log("initLoading ------------------ start");
		document.querySelector(".trigger_popup_fricc")
		.addEventListener("click", function(e){
			console.log("#trigger_popup_fricc click");
			document.querySelector(".hover_bkgr_fricc").style.display = "visible";
		});
		document.querySelector(".hover_bkgr_fricc")
		.addEventListener("click", function(e){
			console.log("#hover_bkgr_fricc click");
			document.querySelector(".hover_bkgr_fricc").style.display = "none";
		});
		document.querySelector(".popupCloseButton")
		.addEventListener("click", function(e){
			console.log("#popupCloseButton click");
			document.querySelector(".hover_bkgr_fricc").style.display = "none";
		});
		console.log("initLoading ------------------ end");
	};
</script>

</head>

<body onload="javascript:initLoading();">

	
	<textarea id="testArea" cols="100" rows="20"></textarea>

	<br/>
	<input type="button" value="JSON formatter" onclick="jsonFormatter();"></input>
	<br/>
	<br/>


	<a class="trigger_popup_fricc">Click here to show the popup</a>
	<div class="hover_bkgr_fricc">
		<span class="helper"></span>
		<div>
			<div class="popupCloseButton">X</div>
			<p>Add any HTML content<br />inside the popup box!</p>
		</div>
	</div>


	<table id="singleTable">
		<tbody id="tbody002"></tbody>
	</table>

	<table id="testTable">
		<tbody id="tbody001"></tbody>
	</table>

</body>
</html>

