<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<style>
	table { 
		border:1px solid #000; 
		font-family: 微軟正黑體; 
		font-size:16px; 
		width:200px;
		border:1px solid #000;
		text-align:center;
		border-collapse:collapse;
	} 
	th { 
		background-color: #009FCC;
		padding:10px;
		border:1px solid #000;
		color:#fff;
	} 
	td { 
		border:1px solid #000;
		padding:5px;
	} 
</style>

<script type="text/javascript">
	function jsonFormatter(){
		var text = document.querySelector("#testArea").value;
		var lines = text.split('\n');
		var arry = new Array();
		for(var i = 0;i < lines.length;i++){
			var line = lines[i];
			var json = toJson(line);
			if(json){
				arry.push(json);
			}
		}

		var tbody = getTbody();		

		var keys;
		for(var idx in arry){
			var obj = arry[idx];
			if(!keys){
				var tr = createTr();
				tr.appendChild(createTh("選擇"));
				keys = [];
				for(var k in obj){
					keys.push(k);
					var td = createTh(k);
					tr.appendChild(td);
				}
				if(keys.length == 0){
					keys = null;
					continue;
				}
				tbody.appendChild(tr);
			}

			var tr = createTr();
			tr.appendChild(createChoice(obj, idx));
			for(var idx2 in keys){
				var value = obj[keys[idx2]];
				var td = createTd(value);
				tr.appendChild(td);
			}
			tbody.appendChild(tr);
		}
	}

	function getTbody(){
		var tbody1 = document.querySelector("#tbody001");
		var tbody2 = document.createElement("tbody");
		tbody2.setAttribute("id", "tbody001");
		tbody1.parentNode.replaceChild(tbody2, tbody1);
		return tbody2;
	}

	function createChoice(json, idx){
		var td = document.createElement("td");
		var radio = document.createElement("input");
		var textArea = document.createElement("textarea");
		radio.setAttribute("type", "radio");
		radio.setAttribute("name", "testRadio");
		radio.setAttribute("onclick", "javascript:showRecord("+idx+");");
		textArea.setAttribute("style", "display:none;");
		textArea.setAttribute("id", "area_" + idx);
		var text = document.createTextNode(JSON.stringify(json));
		textArea.appendChild(text);
		td.appendChild(textArea);
		td.appendChild(radio);
		return td;
	}

	function showRecord(idx){
		var text = document.querySelector("#area_" + idx).innerText;
		console.log("record = " + text);
		var json = JSON.parse(text);

		var tbody1 = document.querySelector("#tbody002");
		var tbody2 = document.createElement("tbody");
		tbody2.setAttribute("id", "tbody002");
		tbody1.parentNode.replaceChild(tbody2, tbody1);

		var tr1 = document.createElement("tr");
		tr1.appendChild(createTh("欄位"));
		tr1.appendChild(createTh("值"));
		tbody2.appendChild(tr1);

		for(var k in json) {
			var tr = document.createElement("tr");
			tr.appendChild(createTd(k));
			tr.appendChild(createTd(json[k]));
			tbody2.appendChild(tr);
		}
	}

	function createTr(){
		return document.createElement("tr");
	}

	function createTh(data){
		var td = document.createElement("th");
		var text = document.createTextNode(data);
		td.appendChild(text);
		return td;
	}

	function createTd(data){
		var td = document.createElement("td");
		var text = document.createTextNode(data);
		td.appendChild(text);
		return td;
	}

	function toJson(line){
		var json = {};
		var reg = /(\w+)\s*\=\s*(.*?)[\,\]]/gi;
		var found;
		while (found = reg.exec(line)) {
			var key = found[1];
			var value = found[2];
			console.log("----" + key + " = " + value);
			json[key] = value;
		}
		console.log(json)
		return json;
	}
</script>

</head>

<body>

	
	<textarea id="testArea" cols="100" rows="20"></textarea>

	<br/>
	<input type="button" value="JSON formatter" onclick="jsonFormatter();"></input>
	<br/>
	<br/>

	<table id="singleTable">
		<tbody id="tbody002"></tbody>
	</table>

	<table id="testTable">
		<tbody id="tbody001"></tbody>
	</table>

</body>
</html>

