from enum import Enum
import re

import openpyxl

from gtu.collection import mapUtil
from gtu.string import stringUtil
from gtu.db.mysql import mysqlTestUtil


class RegionGroupDetail(Enum):
    Region1 = ("總計")
    Region65000000 = ("新北市")
    Region65000010 = ("板橋區")
    Region65000020 = ("三重區")
    Region65000030 = ("中和區")
    Region65000040 = ("永和區")
    Region65000050 = ("新莊區")
    Region65000060 = ("新店區")
    Region65000070 = ("樹林區")
    Region65000080 = ("鶯歌區")
    Region65000090 = ("三峽區")
    Region65000100 = ("淡水區")
    Region65000110 = ("汐止區")
    Region65000120 = ("瑞芳區")
    Region65000130 = ("土城區")
    Region65000140 = ("蘆洲區")
    Region65000150 = ("五股區")
    Region65000160 = ("泰山區")
    Region65000170 = ("林口區")
    Region65000180 = ("深坑區")
    Region65000190 = ("石碇區")
    Region65000200 = ("坪林區")
    Region65000210 = ("三芝區")
    Region65000220 = ("石門區")
    Region65000230 = ("八里區")
    Region65000240 = ("平溪區")
    Region65000250 = ("雙溪區")
    Region65000260 = ("貢寮區")
    Region65000270 = ("金山區")
    Region65000280 = ("萬里區")
    Region65000290 = ("烏來區")
    Region63000000 = ("臺北市")
    Region63000010 = ("松山區")
    Region63000020 = ("信義區")
    Region63000030 = ("大安區")
    Region63000040 = ("中山區")
    Region63000050 = ("中正區")
    Region63000060 = ("大同區")
    Region63000070 = ("萬華區")
    Region63000080 = ("文山區")
    Region63000090 = ("南港區")
    Region63000100 = ("內湖區")
    Region63000110 = ("士林區")
    Region63000120 = ("北投區")
    Region68000000 = ("桃園市")
    Region68000010 = ("桃園區")
    Region68000020 = ("中壢區")
    Region68000030 = ("大溪區")
    Region68000040 = ("楊梅區")
    Region68000050 = ("蘆竹區")
    Region68000060 = ("大園區")
    Region68000070 = ("龜山區")
    Region68000080 = ("八德區")
    Region68000090 = ("龍潭區")
    Region68000100 = ("平鎮區")
    Region68000110 = ("新屋區")
    Region68000120 = ("觀音區")
    Region68000130 = ("復興區")
    Region66000000 = ("臺中市")
    Region66000010 = ("中區")
    Region66000020 = ("東區")
    Region66000030 = ("南區")
    Region66000040 = ("西區")
    Region66000050 = ("北區")
    Region66000060 = ("西屯區")
    Region66000070 = ("南屯區")
    Region66000080 = ("北屯區")
    Region66000090 = ("豐原區")
    Region66000100 = ("東勢區")
    Region66000110 = ("大甲區")
    Region66000120 = ("清水區")
    Region66000130 = ("沙鹿區")
    Region66000140 = ("梧棲區")
    Region66000150 = ("后里區")
    Region66000160 = ("神岡區")
    Region66000170 = ("潭子區")
    Region66000180 = ("大雅區")
    Region66000190 = ("新社區")
    Region66000200 = ("石岡區")
    Region66000210 = ("外埔區")
    Region66000220 = ("大安區")
    Region66000230 = ("烏日區")
    Region66000240 = ("大肚區")
    Region66000250 = ("龍井區")
    Region66000260 = ("霧峰區")
    Region66000270 = ("太平區")
    Region66000280 = ("大里區")
    Region66000290 = ("和平區")
    Region67000000 = ("臺南市")
    Region67000010 = ("新營區")
    Region67000020 = ("鹽水區")
    Region67000030 = ("白河區")
    Region67000040 = ("柳營區")
    Region67000050 = ("後壁區")
    Region67000060 = ("東山區")
    Region67000070 = ("麻豆區")
    Region67000080 = ("下營區")
    Region67000090 = ("六甲區")
    Region67000100 = ("官田區")
    Region67000110 = ("大內區")
    Region67000120 = ("佳里區")
    Region67000130 = ("學甲區")
    Region67000140 = ("西港區")
    Region67000150 = ("七股區")
    Region67000160 = ("將軍區")
    Region67000170 = ("北門區")
    Region67000180 = ("新化區")
    Region67000190 = ("善化區")
    Region67000200 = ("新市區")
    Region67000210 = ("安定區")
    Region67000220 = ("山上區")
    Region67000230 = ("玉井區")
    Region67000240 = ("楠西區")
    Region67000250 = ("南化區")
    Region67000260 = ("左鎮區")
    Region67000270 = ("仁德區")
    Region67000280 = ("歸仁區")
    Region67000290 = ("關廟區")
    Region67000300 = ("龍崎區")
    Region67000310 = ("永康區")
    Region67000320 = ("東區")
    Region67000330 = ("南區")
    Region67000340 = ("北區")
    Region67000350 = ("安南區")
    Region67000360 = ("安平區")
    Region67000370 = ("中西區")
    Region64000000 = ("高雄市")
    Region64000010 = ("鹽埕區")
    Region64000020 = ("鼓山區")
    Region64000030 = ("左營區")
    Region64000040 = ("楠梓區")
    Region64000050 = ("三民區")
    Region64000051 = ("三民一")
    Region64000052 = ("三民二")
    Region64000060 = ("新興區")
    Region64000070 = ("前金區")
    Region64000080 = ("苓雅區")
    Region64000090 = ("前鎮區")
    Region64000100 = ("旗津區")
    Region64000110 = ("小港區")
    Region64000120 = ("鳳山區")
    Region64000121 = ("鳳山一")
    Region64000122 = ("鳳山二")
    Region64000130 = ("林園區")
    Region64000140 = ("大寮區")
    Region64000150 = ("大樹區")
    Region64000160 = ("大社區")
    Region64000170 = ("仁武區")
    Region64000180 = ("鳥松區")
    Region64000190 = ("岡山區")
    Region64000200 = ("橋頭區")
    Region64000210 = ("燕巢區")
    Region64000220 = ("田寮區")
    Region64000230 = ("阿蓮區")
    Region64000240 = ("路竹區")
    Region64000250 = ("湖內區")
    Region64000260 = ("茄萣區")
    Region64000270 = ("永安區")
    Region64000280 = ("彌陀區")
    Region64000290 = ("梓官區")
    Region64000300 = ("旗山區")
    Region64000310 = ("美濃區")
    Region64000320 = ("六龜區")
    Region64000330 = ("甲仙區")
    Region64000340 = ("杉林區")
    Region64000350 = ("內門區")
    Region64000360 = ("茂林區")
    Region64000370 = ("桃源區")
    Region64000380 = ("那瑪夏區")
    Region10000000 = ("臺灣省")
    Region10002000 = ("宜蘭縣")
    Region10002010 = ("宜蘭市")
    Region10002020 = ("羅東鎮")
    Region10002030 = ("蘇澳鎮")
    Region10002040 = ("頭城鎮")
    Region10002050 = ("礁溪鄉")
    Region10002060 = ("壯圍鄉")
    Region10002070 = ("員山鄉")
    Region10002080 = ("冬山鄉")
    Region10002090 = ("五結鄉")
    Region10002100 = ("三星鄉")
    Region10002110 = ("大同鄉")
    Region10002120 = ("南澳鄉")
    Region10004000 = ("新竹縣")
    Region10004010 = ("竹北市")
    Region10004040 = ("關西鎮")
    Region10004030 = ("新埔鎮")
    Region10004020 = ("竹東鎮")
    Region10004050 = ("湖口鄉")
    Region10004080 = ("橫山鄉")
    Region10004060 = ("新豐鄉")
    Region10004070 = ("芎林鄉")
    Region10004100 = ("寶山鄉")
    Region10004090 = ("北埔鄉")
    Region10004110 = ("峨眉鄉")
    Region10004120 = ("尖石鄉")
    Region10004130 = ("五峰鄉")
    Region10005000 = ("苗栗縣")
    Region10005010 = ("苗栗市")
    Region10005050 = ("頭份市")
    Region10005020 = ("苑裡鎮")
    Region10005030 = ("通霄鎮")
    Region10005040 = ("竹南鎮")
    Region10005060 = ("後龍鎮")
    Region10005070 = ("卓蘭鎮")
    Region10005080 = ("大湖鄉")
    Region10005090 = ("公館鄉")
    Region10005100 = ("銅鑼鄉")
    Region10005110 = ("南庄鄉")
    Region10005120 = ("頭屋鄉")
    Region10005130 = ("三義鄉")
    Region10005140 = ("西湖鄉")
    Region10005150 = ("造橋鄉")
    Region10005160 = ("三灣鄉")
    Region10005170 = ("獅潭鄉")
    Region10005180 = ("泰安鄉")
    Region10007000 = ("彰化縣")
    Region10007010 = ("彰化市")
    Region10007100 = ("員林市")
    Region10007020 = ("鹿港鎮")
    Region10007030 = ("和美鎮")
    Region10007190 = ("北斗鎮")
    Region10007110 = ("溪湖鎮")
    Region10007120 = ("田中鎮")
    Region10007200 = ("二林鎮")
    Region10007040 = ("線西鄉")
    Region10007050 = ("伸港鄉")
    Region10007060 = ("福興鄉")
    Region10007070 = ("秀水鄉")
    Region10007080 = ("花壇鄉")
    Region10007090 = ("芬園鄉")
    Region10007130 = ("大村鄉")
    Region10007140 = ("埔鹽鄉")
    Region10007150 = ("埔心鄉")
    Region10007160 = ("永靖鄉")
    Region10007170 = ("社頭鄉")
    Region10007180 = ("二水鄉")
    Region10007210 = ("田尾鄉")
    Region10007220 = ("埤頭鄉")
    Region10007230 = ("芳苑鄉")
    Region10007240 = ("大城鄉")
    Region10007250 = ("竹塘鄉")
    Region10007260 = ("溪州鄉")
    Region10008000 = ("南投縣")
    Region10008010 = ("南投市")
    Region10008020 = ("埔里鎮")
    Region10008030 = ("草屯鎮")
    Region10008040 = ("竹山鎮")
    Region10008050 = ("集集鎮")
    Region10008060 = ("名間鄉")
    Region10008070 = ("鹿谷鄉")
    Region10008080 = ("中寮鄉")
    Region10008090 = ("魚池鄉")
    Region10008100 = ("國姓鄉")
    Region10008110 = ("水里鄉")
    Region10008120 = ("信義鄉")
    Region10008130 = ("仁愛鄉")
    Region10009000 = ("雲林縣")
    Region10009010 = ("斗六市")
    Region10009020 = ("斗南鎮")
    Region10009030 = ("虎尾鎮")
    Region10009040 = ("西螺鎮")
    Region10009050 = ("土庫鎮")
    Region10009060 = ("北港鎮")
    Region10009070 = ("古坑鄉")
    Region10009080 = ("大埤鄉")
    Region10009090 = ("莿桐鄉")
    Region10009100 = ("林內鄉")
    Region10009110 = ("二崙鄉")
    Region10009120 = ("崙背鄉")
    Region10009130 = ("麥寮鄉")
    Region10009140 = ("東勢鄉")
    Region10009150 = ("褒忠鄉")
    Region10009160 = ("臺西鄉")
    Region10009170 = ("元長鄉")
    Region10009180 = ("四湖鄉")
    Region10009190 = ("口湖鄉")
    Region10009200 = ("水林鄉")
    Region10010000 = ("嘉義縣")
    Region10010010 = ("太保市")
    Region10010020 = ("朴子市")
    Region10010030 = ("布袋鎮")
    Region10010040 = ("大林鎮")
    Region10010050 = ("民雄鄉")
    Region10010060 = ("溪口鄉")
    Region10010070 = ("新港鄉")
    Region10010080 = ("六腳鄉")
    Region10010090 = ("東石鄉")
    Region10010100 = ("義竹鄉")
    Region10010110 = ("鹿草鄉")
    Region10010120 = ("水上鄉")
    Region10010130 = ("中埔鄉")
    Region10010140 = ("竹崎鄉")
    Region10010150 = ("梅山鄉")
    Region10010160 = ("番路鄉")
    Region10010170 = ("大埔鄉")
    Region10010180 = ("阿里山鄉")
    Region10013000 = ("屏東縣")
    Region10013010 = ("屏東市")
    Region10013020 = ("潮州鎮")
    Region10013030 = ("東港鎮")
    Region10013040 = ("恆春鎮")
    Region10013050 = ("萬丹鄉")
    Region10013060 = ("長治鄉")
    Region10013070 = ("麟洛鄉")
    Region10013080 = ("九如鄉")
    Region10013090 = ("里港鄉")
    Region10013100 = ("鹽埔鄉")
    Region10013110 = ("高樹鄉")
    Region10013120 = ("萬巒鄉")
    Region10013130 = ("內埔鄉")
    Region10013140 = ("竹田鄉")
    Region10013150 = ("新埤鄉")
    Region10013160 = ("枋寮鄉")
    Region10013170 = ("新園鄉")
    Region10013180 = ("崁頂鄉")
    Region10013190 = ("林邊鄉")
    Region10013200 = ("南州鄉")
    Region10013210 = ("佳冬鄉")
    Region10013220 = ("琉球鄉")
    Region10013230 = ("車城鄉")
    Region10013240 = ("滿州鄉")
    Region10013250 = ("枋山鄉")
    Region10013260 = ("三地門鄉")
    Region10013270 = ("霧臺鄉")
    Region10013280 = ("瑪家鄉")
    Region10013290 = ("泰武鄉")
    Region10013300 = ("來義鄉")
    Region10013310 = ("春日鄉")
    Region10013320 = ("獅子鄉")
    Region10013330 = ("牡丹鄉")
    Region10014000 = ("臺東縣")
    Region10014010 = ("臺東市")
    Region10014020 = ("成功鎮")
    Region10014030 = ("關山鎮")
    Region10014040 = ("卑南鄉")
    Region10014100 = ("大武鄉")
    Region10014090 = ("太麻里鄉")
    Region10014070 = ("東河鄉")
    Region10014080 = ("長濱鄉")
    Region10014050 = ("鹿野鄉")
    Region10014060 = ("池上鄉")
    Region10014110 = ("綠島鄉")
    Region10014130 = ("延平鄉")
    Region10014120 = ("海端鄉")
    Region10014150 = ("達仁鄉")
    Region10014140 = ("金峰鄉")
    Region10014160 = ("蘭嶼鄉")
    Region10015000 = ("花蓮縣")
    Region10015010 = ("花蓮市")
    Region10015020 = ("鳳林鎮")
    Region10015030 = ("玉里鎮")
    Region10015040 = ("新城鄉")
    Region10015050 = ("吉安鄉")
    Region10015060 = ("壽豐鄉")
    Region10015070 = ("光復鄉")
    Region10015080 = ("豐濱鄉")
    Region10015090 = ("瑞穗鄉")
    Region10015100 = ("富里鄉")
    Region10015110 = ("秀林鄉")
    Region10015120 = ("萬榮鄉")
    Region10015130 = ("卓溪鄉")
    Region10016000 = ("澎湖縣")
    Region10016010 = ("馬公市")
    Region10016020 = ("湖西鄉")
    Region10016030 = ("白沙鄉")
    Region10016040 = ("西嶼鄉")
    Region10016050 = ("望安鄉")
    Region10016060 = ("七美鄉")
    Region10017000 = ("基隆市")
    Region10017010 = ("中正區")
    Region10017020 = ("七堵區")
    Region10017030 = ("暖暖區")
    Region10017040 = ("仁愛區")
    Region10017050 = ("中山區")
    Region10017060 = ("安樂區")
    Region10017070 = ("信義區")
    Region10018000 = ("新竹市")
    Region10018010 = ("東區")
    Region10018020 = ("北區")
    Region10018030 = ("香山區")
    Region10020000 = ("嘉義市")
    Region10020010 = ("東區")
    Region10020020 = ("西區")
    Region09 = ("福建省")
    Region09020000 = ("金門縣")
    Region09020010 = ("金城鎮")
    Region09020030 = ("金湖鎮")
    Region09020020 = ("金沙鎮")
    Region09020040 = ("金寧鄉")
    Region09020050 = ("烈嶼鄉")
    Region09020060 = ("烏坵鄉")
    Region09007000 = ("連江縣")
    Region09007010 = ("南竿鄉")
    Region09007020 = ("北竿鄉")
    Region09007030 = ("莒光鄉")
    Region09007040 = ("東引鄉")
    RegionX65000260 = ("頁寮區")
    RegionX10013040 = ("恒春鎮")
    
    def __init__(self, chs):
        self.chs = chs
        self.regionCode = re.sub("[a-zA-Z]", "", self.name)
    
    @staticmethod
    def findRegion(chs):
        chs = stringUtil.trimSpace(chs)
        chs = chs.replace("※", "")
        for i, name in enumerate(RegionGroupDetail.__members__, 0):
            e = RegionGroupDetail[name]
            if e.chs == chs:
                return e.regionCode
        return ""
    
    @staticmethod
    def getRegionDefMap(sheet, offset):
        map = {}
        for i, row in enumerate(sheet, 1):
            strVal = stringUtil.trimSpace(str(row[0].value))
            strVal = strVal.replace("※", "")
            if stringUtil.isChinese(strVal):
                region = RegionGroupDetail.findRegion(strVal)
                if region != None :
                    print("-->", i, strVal, region)
                    map[i + offset] = region
                    map[i + offset + 1] = region
                    map[i + offset + 2] = region
                    if strVal == "桃園縣": 
                        global HAS_G8_TAO
                        HAS_G8_TAO = True
        print("regionMap = ", map)
        return map
    
    @staticmethod
    def getTMFDefMap(regionMap):
        map = {}
        st = set(regionMap.keys())
        sorted(st)
        tmpCount = 0
        tmpVal = "";
        for k in st:
            if tmpVal != regionMap[k]:
                tmpCount = 0
                tmpVal = regionMap[k]
                mapUtil.addMap('T', k, map)
            else:
                tmpCount += 1
                if tmpCount == 1:
                    mapUtil.addMap('M', k, map)
                else:
                    mapUtil.addMap('F', k, map)
#         print("TMF defMap = ", map)
        for k,v in map.items() :
            print("TMF defMap - ", k, v)
        return map

class AgeDef(Enum):
    _0 = ("0")
#     R01=("1~4")
    _1 = ("1")
    _2 = ("2")
    _3 = ("3")
    _4 = ("4")
    R05 = ("5~9")
    R10 = ("10~14")
    R15 = ("15~19")
    R20 = ("20~24")
    R25 = ("25~29")
    R30 = ("30~34")
    R35 = ("35~39")
    R40 = ("40~44")
    R45 = ("45~49")
    R50 = ("50~54")
    R55 = ("55~59")
    R60 = ("60~64")
    R65 = ("65~69")
    R70 = ("70~74")
    R75 = ("75~79")
    R80 = ("80~84")
    R85 = ("85~89")
    R90 = ("90~94")
    R95 = ("95~99")
    _100 = ("100+")
#     _50=("50+")
#     _14=("0-14")
#     _15=("15-64")
#     _65=("65+")
#     _15=("15-49")
#     _15=("15+")
    def __init__(self, chs):
        self.chs = chs
        
    @staticmethod
    def getAgeDef(chs):
        chs = stringUtil.trimSpace(chs)
        for i, name in enumerate(AgeDef.__members__, 0):
            e = AgeDef[name]
            if e.chs == chs :
                strVal = e.name
                strVal = re.sub(r"[\_]", "", strVal)
                return strVal
        return ""


class _TestValidateExcel():
    def excelSet(self):
        excelSt = set()
        filePath = "C:/Users/gtu001/Desktop/db_data_歷年/101-105/105_年刊/T-年中.xlsx"
        wb = openpyxl.load_workbook(filePath, 'r', data_only=True)
        sheet = wb.get_sheet_by_name("年中五歲")
        for row in sheet :
            if row[0].value != None :
                excelSt.add(str(row[0].value))
        return excelSt
    def queryExcel(self):
        u = mysqlTestUtil.MysqlTest()
        lst = u.queryForList("select distinct region from redfz601 where substr(region, 6, 3) != '000'")
        lst2 = []
        for i, row in enumerate(lst, 0) :
            lst2.append(row['region'])
        return lst2
    def main(self):
        st = self.excelSet()
        qlist = self.queryExcel()
        for chs in st:
            chs = chs.replace("※", "")
            region = RegionGroupDetail.findRegion(chs)
            if region != "" and not qlist.__contains__(region) :
                print(chs, region)

if __name__ == '__main__' :
    _TestValidateExcel().main()
    print("done...")
            
